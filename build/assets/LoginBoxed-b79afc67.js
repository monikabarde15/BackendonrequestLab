import{c as z,t as K,u as Z,r as n,s as G,j as r,a as e,Z as i,L as H,a0 as J,b as N,y as d}from"./index-3a453257.js";import{I as Q}from"./IconMail-13162bee.js";import{I as V}from"./IconLockDots-e42b2164.js";const ee=()=>{const S=z(),$=K();Z(a=>a.themeConfig);const[g,_]=n.useState(""),[f,F]=n.useState(""),[x,O]=n.useState(""),[D,b]=n.useState(!1),[C,w]=n.useState(!1),[E,R]=n.useState(!1),[u,v]=n.useState(""),[U,q]=n.useState(""),[y,j]=n.useState(""),[I,L]=n.useState(!1),[p,h]=n.useState("");n.useEffect(()=>{S(G("Login Boxed"))},[S]);const M=async a=>{var l;if(a.preventDefault(),v(""),w(!0),!g.trim()||!f.trim()){v("Please fill in all fields."),w(!1);return}try{const t=(await N.post("https://backend.onrequestlab.com/api/v1/users/auth/login",{username:g,password:f},{headers:{"Content-Type":"application/json"},withCredentials:!0})).data;t.user&&(document.cookie=`username=${encodeURIComponent(t.user.username)}; path=/; max-age=86400`,document.cookie=`user_id=${encodeURIComponent(t.user.id)}; path=/; max-age=86400`,document.cookie=`email=${encodeURIComponent(t.user.email)}; path=/; max-age=86400`,document.cookie=`is_staff=${t.user.is_staff}; path=/; max-age=86400`,document.cookie=`access=${t.access}; path=/; max-age=86400`,localStorage.setItem("jwt-auth",t.access),localStorage.setItem("userId",t.user.id),localStorage.setItem("email",t.user.email),localStorage.setItem("username",t.user.username),d.success("Login successful!",{position:"top-center"}),setTimeout(()=>{t.user.id<2?window.location.href="/index":window.location.href="/index/overview"},1200))}catch(o){let t="Invalid username or password.";if((l=o.response)!=null&&l.data){const s=o.response.data;if(s.detail)t=s.detail;else if(s.error)t=s.error;else if(typeof s=="object"){const m=Object.keys(s)[0];Array.isArray(s[m])&&(t=s[m][0])}}v(t),d.error(t,{position:"top-center"})}finally{w(!1)}},A=async a=>{var l;if(a.preventDefault(),h(""),!y.trim()){h("Please enter your email address.");return}L(!0);try{const t=(await N.post("https://backend.onrequestlab.com/api/v1/users/auth/password/reset/",{email:y},{headers:{"Content-Type":"application/json"}})).data.detail||"Reset link sent successfully!";d.success(t,{position:"top-center"}),b(!1),j("")}catch(o){let t="Something went wrong!";if((l=o.response)!=null&&l.data){const s=o.response.data;s.email?t=s.email[0]:s.detail&&(t=s.detail)}h(t)}finally{L(!1)}},B=async()=>{var a,l,o,t,s,m,P,T;if(!x.trim()){d.error("Please enter your email first.",{position:"top-center"});return}R(!0);try{const c=await N.post("https://backend.onrequestlab.com/api/v1/users/auth/resend-otp/",{email:x},{headers:{"Content-Type":"application/json"}}),k=((a=c.data)==null?void 0:a.message)||((l=c.data)==null?void 0:l.detail)||"OTP resent successfully!";d.success(k,{position:"top-center"}),setTimeout(()=>{$("/otp")},1200)}catch(c){const k=((t=(o=c.response)==null?void 0:o.data)==null?void 0:t.message)||((m=(s=c.response)==null?void 0:s.data)==null?void 0:m.error)||((T=(P=c.response)==null?void 0:P.data)==null?void 0:T.detail)||"Failed to resend OTP.";d.error(k,{position:"top-center"})}finally{R(!1)}};return r("div",{children:[e("div",{className:"absolute inset-0",children:e("img",{src:"/assets/images/auth/bg-gradient.png",alt:"background",className:"h-full w-full object-cover"})}),e("div",{className:"relative flex min-h-screen items-center justify-center bg-[url(/assets/images/auth/map.png)] bg-cover bg-center px-6 py-10 dark:bg-[#060818] sm:px-16",children:e("div",{className:"relative w-full max-w-[870px] rounded-md bg-white/60 dark:bg-black/50 p-2 backdrop-blur-lg shadow-lg",children:r("div",{className:"relative flex flex-col justify-center rounded-md bg-white/80 px-6 py-20 dark:bg-black/60",children:[r("div",{className:"mx-auto w-full max-w-[440px]",children:[r("div",{className:"mb-10 text-center",children:[e("h1",{className:"text-3xl font-extrabold uppercase text-primary md:text-4xl",children:i.t("Sign in")}),e("p",{className:"text-base font-bold text-white-dark",children:i.t("Enter your credentials to log in")})]}),r("form",{className:"space-y-5 dark:text-white",onSubmit:M,children:[r("div",{children:[e("label",{children:i.t("Username or Email")}),r("div",{className:"relative text-white-dark",children:[e("input",{type:"text",placeholder:i.t("Enter username or email"),className:`form-input ps-10 placeholder:text-white-dark ${u.toLowerCase().includes("username")?"border-red-500":""}`,value:g,onChange:a=>_(a.target.value)}),e("span",{className:"absolute start-4 top-1/2 -translate-y-1/2",children:e(Q,{fill:!0})})]})]}),r("div",{children:[e("label",{children:i.t("Password")}),r("div",{className:"relative text-white-dark",children:[e("input",{type:"password",placeholder:i.t("Enter password"),className:`form-input ps-10 placeholder:text-white-dark ${u.toLowerCase().includes("password")?"border-red-500":""}`,value:f,onChange:a=>F(a.target.value)}),e("span",{className:"absolute start-4 top-1/2 -translate-y-1/2",children:e(V,{fill:!0})})]})]}),r("div",{children:[e("label",{children:i.t("Email (for OTP verification)")}),e("input",{type:"email",placeholder:"Enter your registered email",className:`form-input placeholder:text-gray-400 ${U?"border-red-500":""}`,value:x,onChange:a=>{O(a.target.value),q("")}})]}),u&&e("p",{className:"text-red-500 text-sm",children:u}),e("button",{type:"submit",disabled:C,className:"btn btn-gradient !mt-6 w-full uppercase shadow-[0_10px_20px_-10px_rgba(67,97,238,0.44)]",children:C?"Signing in...":"Sign in"}),e("div",{className:"text-center mt-4",children:e("button",{type:"button",disabled:E,onClick:B,className:"text-primary underline text-sm hover:text-black dark:hover:text-white",children:E?"Resending...":"Resend OTP"})}),e("p",{className:"text-primary text-center mt-3 cursor-pointer hover:underline",onClick:()=>b(!0),children:"Forgot Password?"})]})]}),r("div",{className:"text-center mt-6 dark:text-white",children:[i.t("Don't have an account?")," ",e(H,{to:"/auth/boxed-signup",className:"uppercase text-primary underline transition hover:text-black dark:hover:text-white",children:i.t("Register here")})]})]})})}),D&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r("div",{className:"bg-white p-6 rounded-xl shadow-xl w-[90%] max-w-md relative",children:[e("button",{onClick:()=>b(!1),className:"absolute top-2 right-3 text-gray-600 text-lg",children:"âœ•"}),e("h2",{className:"text-2xl font-bold mb-4 text-center text-primary",children:"Reset Password"}),r("form",{onSubmit:A,className:"space-y-4",children:[e("input",{type:"email",placeholder:"Enter your registered email",className:`form-input w-full ${p?"border-red-500":""}`,value:y,onChange:a=>{j(a.target.value),p&&h("")}}),p&&e("p",{className:"text-red-500 text-sm",children:p}),e("button",{type:"submit",disabled:I,className:"btn btn-primary w-full",children:I?"Sending...":"Send Reset Link"})]})]})}),e(J,{autoClose:2e3,theme:"colored"})]})};export{ee as default};
