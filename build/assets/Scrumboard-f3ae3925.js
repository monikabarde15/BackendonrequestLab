import{c as re,r as m,u as ae,s as se,b as g,j as i,a as e,D as ie,o as le,g as A}from"./index-3a453257.js";import{d as oe}from"./index-b73fa71a.js";import{S as ne}from"./sweetalert2.all-af2d037b.js";import{I as J}from"./IconPlus-630b603f.js";import{I as de}from"./IconPlusCircle-4baae553.js";import{I as ce}from"./IconHorizontalDots-1bcd08a1.js";import{I as U}from"./IconTag-e88cea24.js";import{I as pe}from"./IconCalendar-d6a49930.js";import{I as R}from"./IconTrashLines-d8b814c2.js";import{Y as v,y as w}from"./transition-2ed80f48.js";import"./keyboard-9109029c.js";import"./open-closed-2f6678f9.js";import"./hidden-20ea1f40.js";const Te=()=>{const Y=re(),[O,k]=m.useState([]),[l,h]=m.useState(!1),B=ae(t=>t.themeConfig.rtlClass)==="rtl";m.useEffect(()=>{Y(se("Scrumboard")),S()},[]);const S=async()=>{try{h(!0);const t=await g.get("https://cybitbackend.onrender.com/api/projects");console.log("Raw API response:",t.data);const r=(t.data||[]).map(a=>{const o=(a.tasks||[]).map((s,p)=>((s.position===void 0||s.position===null)&&(console.warn(`Task "${s.title}" missing position, assigning ${p}`),s.position=p,s.sortOrder=p),s)).sort((s,p)=>(s.position||0)-(p.position||0));return console.log(`Project "${a.title}" tasks with positions:`,o.map(s=>({id:s.id,title:s.title,position:s.position}))),{...a,tasks:o}});k(r)}catch(t){console.error("Error fetching projects:",t),c("Error loading projects","error")}finally{h(!1)}},[y,P]=m.useState({id:null,title:""}),[u,I]=m.useState({projectId:null,id:null,title:"",description:"",tags:"",date:""}),[$,M]=m.useState(null),[z,j]=m.useState(!1),[L,T]=m.useState(!1),[W,C]=m.useState(!1),H=t=>{const{value:r,id:a}=t.target;P({...y,[a]:r})},q=(t=null)=>{if(P({id:null,title:""}),t){let r=JSON.parse(JSON.stringify(t));P(r)}j(!0)},c=(t="",r="success")=>{ne.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,customClass:{container:"toast"}}).fire({icon:r,title:t,padding:"10px 20px"})},V=async t=>{var r;if(t.preventDefault(),!((r=y.title)!=null&&r.trim())){c("Title is required.","error");return}if(!l)try{if(h(!0),y.id){const a=await g.put(`https://cybitbackend.onrender.com/api/projects/${y.id}`,{title:y.title.trim()});k(n=>n.map(o=>o.id===y.id?{...a.data,tasks:(a.data.tasks||[]).sort((s,p)=>(s.position||0)-(p.position||0))}:o)),c("Project updated successfully.")}else{const a=await g.post("https://cybitbackend.onrender.com/api/projects",{title:y.title.trim()});k(n=>[...n,a.data]),c("Project added successfully.")}j(!1),P({id:null,title:""})}catch(a){console.error("Error saving project:",a),c("Error saving project","error")}finally{h(!1)}},X=async t=>{if(!l)try{h(!0),await g.delete(`https://cybitbackend.onrender.com/api/projects/${t.id}`),k(r=>r.filter(a=>a.id!==t.id)),c("Project deleted successfully.")}catch(r){console.error("Error deleting project:",r),c("Error deleting project","error")}finally{h(!1)}},G=async t=>{if(!l)try{h(!0),await g.put(`https://cybitbackend.onrender.com/api/projects/${t.id}`,{title:t.title,tasks:[]}),k(r=>r.map(a=>a.id===t.id?{...a,tasks:[]}:a)),c("All tasks cleared successfully.")}catch(r){console.error("Error clearing tasks:",r),c("Error clearing tasks","error")}finally{h(!1)}},F=t=>{const{value:r,id:a}=t.target;I({...u,[a]:r})},D=(t,r=null)=>{if(I({projectId:t,id:null,title:"",description:"",tags:"",date:""}),r){let a=JSON.parse(JSON.stringify(r));a.projectId=t,a.tags=a.tags?Array.isArray(a.tags)?a.tags.join(", "):a.tags.toString():"",I(a)}T(!0)},K=async t=>{var r,a,n;if(t.preventDefault(),!((r=u.title)!=null&&r.trim())){c("Title is required.","error");return}if(!l)try{h(!0);const o={title:u.title.trim(),description:((a=u.description)==null?void 0:a.trim())||"",tags:((n=u.tags)==null?void 0:n.trim())||""};if(u.id){const s=await g.put(`https://cybitbackend.onrender.com/api/projects/${u.projectId}/tasks/${u.id}`,o);k(p=>p.map(b=>b.id===u.projectId?{...s.data,tasks:(s.data.tasks||[]).sort((x,d)=>(x.position||0)-(d.position||0))}:b)),c("Task updated successfully.")}else{const s=await g.post(`https://cybitbackend.onrender.com/api/projects/${u.projectId}/tasks`,o);k(p=>p.map(b=>b.id===u.projectId?{...s.data,tasks:(s.data.tasks||[]).sort((x,d)=>(x.position||0)-(d.position||0))}:b)),c("Task added successfully.")}T(!1),I({projectId:null,id:null,title:"",description:"",tags:"",date:""})}catch(o){console.error("Error saving task:",o),c("Error saving task","error")}finally{h(!1)}},Q=(t,r=null)=>{M({...r,projectId:t}),C(!0)},Z=async()=>{if(!l)try{h(!0);const t=await g.delete(`https://cybitbackend.onrender.com/api/projects/${$.projectId}/tasks/${$.id}`);k(r=>r.map(a=>a.id===$.projectId?{...t.data,tasks:(t.data.tasks||[]).sort((n,o)=>(n.position||0)-(o.position||0))}:a)),c("Task deleted successfully."),C(!1),M(null)}catch(t){console.error("Error deleting task:",t),c("Error deleting task","error")}finally{h(!1)}},_=async(t,r)=>{try{const a=O.find(o=>o.id===t);if(!a){console.error("Project not found:",t);return}const n=r.map((o,s)=>({...o,position:s,sortOrder:s,projectId:t,updatedAt:new Date().toISOString()}));console.log("Updating task positions:",n.map(o=>({id:o.id,title:o.title,position:o.position}))),await g.put(`https://cybitbackend.onrender.com/api/projects/${t}`,{title:a.title,tasks:n}),c("Task positions saved successfully!")}catch(a){console.error("Error updating task order:",a),c("Error saving task positions","error"),S()}},ee=t=>(r,a)=>{if(!a||l)return;console.log("Drag and drop triggered for project:",t),console.log("New task order:",r.map(o=>({id:o.id,title:o.title})));const n=t;k(o=>{const s=[...o];let p=[],b=null;r.forEach((d,f)=>{d.projectId&&d.projectId!==n&&(p.push({...d,newPosition:f}),b=d.projectId,console.log(`Task "${d.title}" moved from project ${d.projectId} to ${n}`))});const x=s.findIndex(d=>d.id===n);if(x!==-1){const d=r.map((f,N)=>({...f,projectId:n,position:N,sortOrder:N}));console.log(`Updated project ${n} with tasks:`,d.map(f=>({id:f.id,title:f.title,position:f.position}))),s[x]={...s[x],tasks:d}}if(p.length>0&&b&&b!==n){const d=s.findIndex(f=>f.id===b);if(d!==-1){const f=s[d].tasks.filter(N=>!p.some(E=>E.id===N.id)).map((N,E)=>({...N,position:E,sortOrder:E}));s[d]={...s[d],tasks:f}}te(b,n,s)}else console.log("Same project reordering - calling updateTaskOrder"),_(n,r);return s})},te=async(t,r,a)=>{try{const n=a.find(p=>p.id===t),o=a.find(p=>p.id===r),s=[];n&&s.push(g.put(`https://cybitbackend.onrender.com/api/projects/${t}`,{title:n.title,tasks:n.tasks})),o&&s.push(g.put(`https://cybitbackend.onrender.com/api/projects/${r}`,{title:o.title,tasks:o.tasks})),await Promise.all(s),c("Task moved between projects successfully!")}catch(n){console.error("Error handling cross-project move:",n),c("Error moving task between projects","error"),S()}};return i("div",{children:[i("div",{className:"flex items-center justify-between mb-5",children:[e("h2",{className:"text-xl font-semibold",children:"Scrumboard"}),i("button",{type:"button",className:"btn btn-primary flex",onClick:()=>q(),disabled:l,children:[e(J,{className:"w-5 h-5 ltr:mr-3 rtl:ml-3"}),"Add Project"]})]}),l&&e("div",{className:"flex justify-center mb-4",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e("div",{className:"relative pt-5",children:e("div",{className:"perfect-scrollbar h-full -mx-2",children:e("div",{className:"overflow-x-auto flex items-start flex-nowrap gap-5 pb-2 px-2",children:O.map(t=>i("div",{className:"panel w-80 flex-none","data-group":t.id,children:[i("div",{className:"flex justify-between mb-5",children:[e("h4",{className:"text-base font-semibold",children:t.title}),i("div",{className:"flex items-center",children:[e("button",{onClick:()=>D(t.id),type:"button",className:"hover:text-primary ltr:mr-2 rtl:ml-2",disabled:l,children:e(de,{})}),e("div",{className:"dropdown",children:e(ie,{offset:[0,5],placement:`${B?"bottom-start":"bottom-end"}`,button:e(ce,{className:"opacity-70 hover:opacity-100"}),children:i("ul",{children:[e("li",{children:e("button",{type:"button",onClick:()=>q(t),disabled:l,children:"Edit"})}),e("li",{children:e("button",{type:"button",onClick:()=>X(t),disabled:l,children:"Delete"})}),e("li",{children:e("button",{type:"button",onClick:()=>G(t),disabled:l,children:"Clear All"})})]})})})]})]}),e(oe.ReactSortable,{list:t.tasks||[],setList:ee(t.id),animation:200,group:{name:"shared",pull:!0,put:!0},ghostClass:"sortable-ghost",dragClass:"sortable-drag",className:"connect-sorting-content min-h-[150px] bg-gray-50 dark:bg-gray-800/50 rounded-lg p-2",disabled:l,sort:!0,children:(t.tasks||[]).length===0?i("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:[e("div",{className:"text-2xl mb-2",children:"ðŸ“‹"}),e("p",{className:"text-sm",children:'Drop tasks here or click "Add Task"'}),e("p",{className:"text-xs mt-1 opacity-70",children:"Position will be saved automatically"})]}):(t.tasks||[]).sort((r,a)=>(r.position||0)-(a.position||0)).map((r,a)=>{var n;return e("div",{className:"sortable-list",children:i("div",{className:"shadow bg-white dark:bg-gray-700 p-4 rounded-lg mb-3 space-y-3 cursor-move hover:shadow-lg transition-all duration-200 border border-gray-200 dark:border-gray-600 relative",children:[i("div",{className:"absolute top-2 right-2 text-xs bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 px-2 py-1 rounded-full",children:["#",r.position!==void 0?r.position+1:a+1]}),r.image&&e("img",{src:"/assets/images/carousel1.jpeg",alt:"Task",className:"h-32 w-full object-cover rounded-md"}),e("div",{className:"text-base font-medium pr-8",children:r.title}),e("p",{className:"break-all text-sm text-gray-600 dark:text-gray-300",children:r.description}),e("div",{className:"flex gap-2 items-center flex-wrap",children:(n=r.tags)!=null&&n.length?r.tags.map((o,s)=>i("div",{className:"btn px-2 py-1 flex btn-outline-primary text-xs",children:[e(U,{className:"shrink-0 w-3 h-3"}),e("span",{className:"ltr:ml-1 rtl:mr-1",children:o})]},`${r.id}-tag-${s}`)):i("div",{className:"btn px-2 py-1 flex text-white-dark dark:border-white-dark/50 shadow-none text-xs",children:[e(U,{className:"shrink-0 w-3 h-3"}),e("span",{className:"ltr:ml-1 rtl:mr-1",children:"No Tags"})]})}),i("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-600",children:[i("div",{className:"font-medium flex items-center hover:text-primary text-sm",children:[e(pe,{className:"ltr:mr-2 rtl:ml-2 shrink-0 w-4 h-4"}),e("span",{children:r.date})]}),i("div",{className:"flex items-center gap-2",children:[e("button",{onClick:()=>D(t.id,r),type:"button",className:"p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded transition-colors",disabled:l,title:"Edit Task",children:e(le,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e("button",{onClick:()=>Q(t.id,r),type:"button",className:"p-1 hover:bg-red-100 dark:hover:bg-red-900 rounded transition-colors",disabled:l,title:"Delete Task",children:e(R,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]})]})]})},`${t.id}-${r.id}-${a}`)})}),e("div",{className:"pt-3",children:i("button",{type:"button",className:"btn btn-primary w-full",onClick:()=>D(t.id),disabled:l,children:[e(J,{className:"w-4 h-4 ltr:mr-2 rtl:ml-2"}),"Add Task"]})})]},t.id))})})}),e(v,{appear:!0,show:z,as:m.Fragment,children:i(w,{as:"div",open:z,onClose:()=>!l&&j(!1),className:"relative z-[51]",children:[e(v.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0 bg-[black]/60"})}),e("div",{className:"fixed inset-0 z-[999] px-4 overflow-y-auto",children:e("div",{className:"flex items-center justify-center min-h-screen",children:e(v.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:i(w.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[e("button",{type:"button",onClick:()=>j(!1),className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",disabled:l,children:e(A,{})}),e("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:y.id?"Edit Project":"Add Project"}),e("div",{className:"p-5",children:i("form",{onSubmit:V,children:[e("div",{className:"grid gap-5",children:i("div",{children:[e("label",{htmlFor:"title",children:"Project Name"}),e("input",{id:"title",value:y.title,onChange:H,type:"text",className:"form-input mt-1",placeholder:"Enter Project Name",required:!0,disabled:l})]})}),i("div",{className:"flex justify-end items-center mt-8 gap-3",children:[e("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>j(!1),disabled:l,children:"Cancel"}),i("button",{type:"submit",className:"btn btn-primary",disabled:l,children:[l?e("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 ltr:mr-2 rtl:ml-2"}):null,y.id?"Update":"Add"]})]})]})})]})})})})]})}),e(v,{appear:!0,show:L,as:m.Fragment,children:i(w,{as:"div",open:L,onClose:()=>!l&&T(!1),className:"relative z-50",children:[e(v.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0 bg-[black]/60"})}),e("div",{className:"fixed inset-0 z-[999] overflow-y-auto",children:e("div",{className:"flex items-center justify-center min-h-screen px-4",children:i(w.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[e("button",{onClick:()=>T(!1),type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-white-dark hover:text-dark",disabled:l,children:e(A,{})}),e("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:u.id?"Edit Task":"Add Task"}),e("div",{className:"p-5",children:i("form",{onSubmit:K,children:[i("div",{className:"grid gap-5",children:[i("div",{children:[e("label",{htmlFor:"taskTitle",children:"Task Name"}),e("input",{id:"title",value:u.title,onChange:F,type:"text",className:"form-input",placeholder:"Enter Task Name",required:!0,disabled:l})]}),i("div",{children:[e("label",{htmlFor:"taskTag",children:"Tags (comma separated)"}),e("input",{id:"tags",value:u.tags,onChange:F,type:"text",className:"form-input",placeholder:"Enter Tags (e.g., design, development)",disabled:l})]}),i("div",{children:[e("label",{htmlFor:"taskdesc",children:"Description"}),e("textarea",{id:"description",value:u.description,onChange:F,className:"form-textarea min-h-[130px]",placeholder:"Enter Task Description",disabled:l})]})]}),i("div",{className:"flex justify-end items-center mt-8 gap-3",children:[e("button",{onClick:()=>T(!1),type:"button",className:"btn btn-outline-danger",disabled:l,children:"Cancel"}),i("button",{type:"submit",className:"btn btn-primary",disabled:l,children:[l?e("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 ltr:mr-2 rtl:ml-2"}):null,u.id?"Update":"Add"]})]})]})})]})})})]})}),e(v,{appear:!0,show:W,as:m.Fragment,children:i(w,{as:"div",open:W,onClose:()=>!l&&C(!1),className:"relative z-[51]",children:[e(v.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0 bg-[black]/60"})}),e("div",{className:"fixed inset-0 z-[999] overflow-y-auto",children:e("div",{className:"flex items-center justify-center min-h-screen px-4 ",children:e(v.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:i(w.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden md:w-full max-w-lg w-[90%] my-8",children:[e("button",{type:"button",onClick:()=>C(!1),className:"absolute top-4 ltr:right-4 rtl:left-4 text-white-dark",disabled:l,children:e(A,{})}),e("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"Delete Task"}),i("div",{className:"p-5 text-center",children:[e("div",{className:"text-white bg-danger ring-4 ring-danger/30 p-4 rounded-full w-fit mx-auto",children:e(R,{})}),e("div",{className:"text-base sm:w-3/4 mx-auto mt-5",children:"Are you sure you want to delete this task?"}),i("div",{className:"flex justify-center items-center mt-8 gap-3",children:[e("button",{onClick:()=>C(!1),type:"button",className:"btn btn-outline-danger",disabled:l,children:"Cancel"}),i("button",{onClick:Z,type:"button",className:"btn btn-primary",disabled:l,children:[l?e("span",{className:"animate-spin border-2 border-white border-l-transparent rounded-full w-4 h-4 ltr:mr-2 rtl:ml-2"}):null,"Delete"]})]})]})]})})})})]})})]})};export{Te as default};
