import{r as t,j as n,F as E,a as s,b as z}from"./index-3a453257.js";const D=()=>{const[l,R]=t.useState([]),[a,b]=t.useState(""),[T,y]=t.useState(!1),[d,w]=t.useState(!1),[A,M]=t.useState(""),[j,c]=t.useState(!1),[f,u]=t.useState(!1),p=t.useRef(null),S=t.useRef(null),g=v("user_id"),k=v("access");function v(e){const r=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return r?r[2]:null}const h=async(e=!1)=>{if(g){e||y(!0);try{const o=(await z.get(`https://backend.onrequestlab.com/api/v1/support/chats/messages/?user_id=${g}`,{headers:{Authorization:`Bearer ${k}`}})).data||[];R(o);const C=o.filter(i=>i.sender!=="user");if(C.length){const i=C.reduce((x,m)=>new Date(x.timestamp||x.created_at)>new Date(m.timestamp||m.created_at)?x:m);i.id!==S.current&&(S.current=i.id,M(i.message),c(!0),new Audio("/ticketSound.mp3").play(),setTimeout(()=>c(!1),6e3))}}catch(r){console.error(r)}finally{e||y(!1)}}},I=async()=>{if(a.trim()){w(!0);try{await z.post("https://backend.onrequestlab.com/api/v1/support/chats/messages/",{user_id:g,message:a,attachments:[]},{headers:{Authorization:`Bearer ${k}`}}),b(""),h(!0)}catch(e){console.error(e),alert("Failed to send message.")}finally{w(!1)}}};return t.useEffect(()=>{h();const e=setInterval(()=>h(!0),1e4);return()=>clearInterval(e)},[]),t.useEffect(()=>{p.current&&p.current.scrollIntoView({behavior:"smooth"})},[l]),n(E,{children:[s("div",{onClick:()=>u(!f),style:{position:"fixed",bottom:24,right:24,width:60,height:60,borderRadius:"50%",backgroundColor:"#2563eb",color:"white",fontSize:28,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,0.2)",zIndex:1001,transition:"transform 0.2s ease"},title:"Chat with Support",children:"ğŸ’¬"}),f&&n("div",{style:{position:"fixed",bottom:100,right:24,width:360,height:480,borderRadius:16,background:"#fff",boxShadow:"0 4px 20px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:1e3,animation:"fadeIn 0.3s ease"},children:[n("div",{style:{background:"#2563eb",color:"white",padding:"12px 16px",fontWeight:"bold",fontSize:"1.1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Support Chat",s("span",{onClick:()=>u(!1),style:{cursor:"pointer",fontWeight:"bold",fontSize:18,color:"#fff"},children:"âœ•"})]}),n("div",{style:{flex:1,padding:"12px",background:"#f8fafc",overflowY:"auto"},children:[T?s("div",{style:{textAlign:"center",marginTop:20},children:"Loading..."}):l.length===0?s("div",{style:{textAlign:"center",color:"#9ca3af",marginTop:20},children:"ğŸ‘‹ Hi there! How can we help you today?"}):l.map((e,r)=>{const o=e.sender==="user";return s("div",{style:{display:"flex",justifyContent:o?"flex-end":"flex-start",margin:"8px 0"},children:n("div",{style:{background:o?"#2563eb":"#e2e8f0",color:o?"#fff":"#0f172a",borderRadius:"12px",padding:"10px 14px",maxWidth:"75%",fontSize:"0.95rem",boxShadow:"0 1px 2px #d1d5db"},children:[s("div",{children:e.message}),n("div",{style:{fontSize:"10px",opacity:.8,marginTop:4,textAlign:"right"},children:[o?"You":"Admin"," â€¢"," ",new Date(e.timestamp||e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})},e.id||r)}),s("div",{ref:p})]}),n("div",{style:{borderTop:"1px solid #e2e8f0",padding:10,display:"flex",alignItems:"center",background:"#fff"},children:[s("input",{type:"text",value:a,disabled:d,onChange:e=>b(e.target.value),onKeyDown:e=>e.key==="Enter"&&!d&&I(),placeholder:"Type your message...",style:{flex:1,padding:"10px",border:"1px solid #cbd5e1",borderRadius:8,outline:"none",fontSize:"0.95rem"}}),s("button",{onClick:I,disabled:!a.trim()||d,style:{marginLeft:8,background:"#2563eb",color:"#fff",border:"none",padding:"10px 16px",borderRadius:8,cursor:"pointer",fontWeight:"600"},children:d?"...":"Send"})]})]}),j&&!f&&n("div",{style:{position:"fixed",right:20,bottom:100,background:"#2563eb",color:"#fff",padding:"12px 16px",borderRadius:12,zIndex:1e3,cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},onClick:()=>{u(!0),c(!1)},children:[s("strong",{children:"New Message:"})," ",A]})]})};export{D as default};
