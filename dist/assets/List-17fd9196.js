import{c as j,r,s as F,j as i,a as s,L as G,N as L,o as O,b as C}from"./index-3a453257.js";import{N as _}from"./index-878e7aa5.js";import{s as R}from"./sortBy-eb07e771.js";import{I as $}from"./IconTrashLines-d8b814c2.js";import{I as H}from"./IconPlus-630b603f.js";import{I as Y}from"./IconEye-68638707.js";import{F as Z,z as A}from"./index-37c81567.js";import"./floating-ui.dom.browser.min-41a73232.js";import"./_baseIsEqual-2369fab6.js";import"./_defineProperty-4aa8791e.js";const se=()=>{const I=j(),[u,w]=r.useState([]),[N,p]=r.useState(1),P=[10,20,30,50,100],[n,D]=r.useState(P[0]),[h,f]=r.useState([]),[k,l]=r.useState([]),[S,x]=r.useState([]),[c,y]=r.useState(""),[g,z]=r.useState({columnAccessor:"invoice",direction:"asc"});r.useEffect(()=>{I(F("Invoice List"))},[I]);const B=async()=>{try{const a=((await C.get("https://cybitbackend.onrender.com/api/invoices")).data.invoices||[]).map(o=>{var d,m;const b=o.items.reduce((v,U)=>v+U.amount,0);return{id:o._id,invoice:o.invoiceNumber,name:((d=o.billing)==null?void 0:d.name)||"N/A",email:((m=o.billing)==null?void 0:m.email)||"N/A",date:o.invoiceDate?new Date(o.invoiceDate).toLocaleDateString():"N/A",amount:b,currency:o.currency||"USD",status:{tooltip:"Pending",color:"danger"}}});w(a),f(R(a,"invoice")),l(R(a,"invoice").slice(0,n))}catch(e){console.error("Error fetching invoices:",e)}};r.useEffect(()=>{B()},[]);const E=async(e=null)=>{if(window.confirm("Are you sure want to delete selected row?"))try{if(e){await C.delete(`https://cybitbackend.onrender.com/api/invoices/${e}`);const t=u.filter(a=>a.id!==e);w(t),f(t),l(t),x([]),y(""),A.success("Invoice deleted successfully")}else if(S.length){const t=S.map(o=>o.id);await Promise.all(t.map(o=>C.delete(`https://cybitbackend.onrender.com/api/invoices/${o}`)));const a=u.filter(o=>!t.includes(o.id));w(a),f(a),l(a),x([]),y(""),p(1),A.success("Selected invoices deleted successfully")}}catch(t){console.error("Error deleting invoice(s):",t),alert("Failed to delete invoice(s).")}},T={USD:"$","USD - US Dollar":"$","GBP - British Pound":"£","IDR - Indonesian Rupiah":"Rp","INR - Indian Rupee":"₹","BRL - Brazilian Real":"R$","EUR - Germany (Euro)":"€","TRY - Turkish Lira":"₺"};return r.useEffect(()=>{p(1)},[n]),r.useEffect(()=>{const e=(N-1)*n,t=e+n;l([...h.slice(e,t)])},[N,n,h]),r.useEffect(()=>{f(u.filter(e=>{var t,a,o,b,d,m,v;return((t=e.invoice)==null?void 0:t.toLowerCase().includes(c.toLowerCase()))||((a=e.name)==null?void 0:a.toLowerCase().includes(c.toLowerCase()))||((o=e.email)==null?void 0:o.toLowerCase().includes(c.toLowerCase()))||((b=e.date)==null?void 0:b.toLowerCase().includes(c.toLowerCase()))||((d=e.amount)==null?void 0:d.toString().includes(c.toLowerCase()))||((v=(m=e.status)==null?void 0:m.tooltip)==null?void 0:v.toLowerCase().includes(c.toLowerCase()))}))},[c,u]),r.useEffect(()=>{const e=R(h,g.columnAccessor);l(g.direction==="desc"?e.reverse():e),p(1)},[g]),i("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[s(Z,{position:"top-right",reverseOrder:!1}),i("div",{className:"invoice-table",children:[i("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:[i("div",{className:"flex items-center gap-2",children:[i("button",{type:"button",className:"btn btn-danger gap-2",onClick:()=>E(),children:[s($,{}),"Delete"]}),i(G,{to:"/apps/invoice/add",className:"btn btn-primary gap-2",children:[s(H,{}),"Add New"]})]}),s("div",{className:"ltr:ml-auto rtl:mr-auto",children:s("input",{type:"text",className:"form-input w-auto",placeholder:"Search...",value:c,onChange:e=>y(e.target.value)})})]}),s("div",{className:"datatables pagination-padding",children:s(_,{className:"whitespace-nowrap table-hover invoice-table",records:k,columns:[{accessor:"invoice",sortable:!0,render:({invoice:e})=>s(L,{to:"/apps/invoice/preview",children:s("div",{className:"text-primary underline hover:no-underline font-semibold",children:`#${e}`})})},{accessor:"name",sortable:!0,render:({name:e,id:t})=>s("div",{className:"flex items-center font-semibold",children:s("div",{children:e})})},{accessor:"email",sortable:!0},{accessor:"date",sortable:!0},{accessor:"amount",sortable:!0,titleClassName:"text-right",render:({amount:e,currency:t})=>i("div",{className:"text-right font-semibold",children:[T[t]||t||"$",e]})},{accessor:"status",sortable:!0,render:({status:e})=>s("span",{className:`badge badge-outline-${(e==null?void 0:e.color)||"default"}`,children:(e==null?void 0:e.tooltip)||"N/A"})},{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:({id:e})=>i("div",{className:"flex gap-4 items-center w-max mx-auto",children:[s(L,{to:`/apps/invoice/edit/${e}`,className:"flex hover:text-info",children:s(O,{className:"w-4.5 h-4.5"})}),s(L,{to:`/apps/invoice/preview/${e}`,className:"btn btn-primary w-full gap-2",children:s(Y,{className:"w-4.5 h-4.5"})}),s("button",{type:"button",className:"flex hover:text-danger",onClick:()=>E(e),children:s($,{})})]})}],highlightOnHover:!0,totalRecords:h.length,recordsPerPage:n,page:N,onPageChange:e=>p(e),recordsPerPageOptions:P,onRecordsPerPageChange:D,sortStatus:g,onSortStatusChange:z,selectedRecords:S,onSelectedRecordsChange:x,paginationText:({from:e,to:t,totalRecords:a})=>`Showing  ${e} to ${t} of ${a} entries`})})]})]})};export{se as default};
