import{r as l,u as x,j as a,a as e,L as C,D as w}from"./index-3a453257.js";import{_ as N}from"./react-apexcharts.min-2f0019e0.js";import{I as S}from"./IconHorizontalDots-1bcd08a1.js";import j from"./MessagesList-b166e538.js";const P=({userId:b})=>{const[f,u]=l.useState(!0),[D,g]=l.useState([0,0]),[c,k]=l.useState({series:[{name:"Count",data:[0,0]}],options:{chart:{id:"revenue-chart",toolbar:{show:!0}},colors:["#22C55E","#EF4444"],xaxis:{categories:["Payments","Instances"]}}});x(t=>t.themeConfig.theme==="dark"||t.themeConfig.isDarkMode);const p=t=>{var n;const r=`; ${document.cookie}`.split(`; ${t}=`);if(r.length===2)return(n=r.pop())==null?void 0:n.split(";").shift()},i=JSON.parse(localStorage.getItem("userId")||"{}");console.log("user=",i);const d=p("access"),y=async()=>{try{const t=p("refresh"),r=await(await fetch("https://dev.backend.onrequestlab.com/api/v1/token/refresh/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t})})).json();return r.access?(document.cookie=`access=${r.access}; path=/`,r.access):null}catch(t){return console.error("Failed to refresh token",t),null}};return l.useEffect(()=>{(async()=>{u(!0);let o=d;if(!o&&(o=await y(),!o))return;const r=[{url:`https://backend.onrequestlab.com/api/v1/users/payments/count/${i}/`,name:"Payments"},{url:`https://backend.onrequestlab.com/api/v1/lab/userinst/count/${i}/`,name:"Instances"}],n=["rgba(52,152,219,0.7)","rgba(46,204,113,0.7)","rgba(231,76,60,0.7)","rgba(155,89,182,0.7)","rgba(241,196,15,0.7)","rgba(230,126,34,0.7)"],v=n.map(s=>s.replace("0.7","1"));try{const s=await Promise.all(r.map(async h=>{try{return(await(await fetch(h.url,{headers:{Authorization:`Bearer ${d}`}})).json()).count??0}catch{return 0}}));g(s),k({...c,series:[{name:"Count",data:s}],options:{...c.options,colors:["#22C55E","#EF4444"]}});const m=document.getElementById("progressChart");m&&new Chart(m,{type:"bar",data:{labels:r.map(h=>h.name),datasets:[{label:"Total Count",data:s,backgroundColor:n,borderColor:v,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}catch(s){console.error(s)}finally{u(!1)}})()},[b,d]),a("div",{children:[a("ul",{className:"flex space-x-2 rtl:space-x-reverse",children:[e("li",{children:e(C,{to:"/",className:"text-primary hover:underline",children:"Dashboard"})}),e("li",{className:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2",children:e("span",{children:"User Dashboard"})})]}),a("div",{className:"pt-5",children:[e("div",{className:"grid xl:grid-cols-3 gap-6 mb-6",children:a("div",{className:"panel h-full xl:col-span-2",children:[a("div",{className:"flex items-center justify-between dark:text-white-light mb-5",children:[e("h5",{className:"font-semibold text-lg"}),e("div",{className:"dropdown",children:e(w,{offset:[0,1],placement:"bottom-end",button:e(S,{className:"text-black/70 dark:text-white/70 hover:!text-primary"}),children:a("ul",{children:[e("li",{children:e("button",{type:"button",children:"Weekly"})}),e("li",{children:e("button",{type:"button",children:"Monthly"})}),e("li",{children:e("button",{type:"button",children:"Yearly"})})]})})})]}),e("div",{className:"relative",children:e("div",{className:"bg-white dark:bg-black rounded-lg overflow-hidden",children:f?e("div",{className:"min-h-[325px] grid place-content-center bg-white-light/30 dark:bg-dark dark:bg-opacity-[0.08] ",children:e("span",{className:"animate-spin border-2 border-black dark:border-white !border-l-transparent  rounded-full w-5 h-5 inline-flex"})}):e(N,{series:c.series,options:c.options,type:"area",height:325})})})]})}),e("div",{className:"grid sm:grid-cols-2 xl:grid-cols-3 gap-6 mb-6",children:e("div",{className:"panel h-full p-0"})})]}),e(j,{})]})};export{P as default};
